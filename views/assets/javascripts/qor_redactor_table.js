"use strict";!function(l){l.add("plugin","table",{translations:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table","clear-table-style":"Clear table style"}},init:function(e){this.app=e,this.lang=e.lang,this.opts=e.opts,this.caret=e.caret,this.editor=e.editor,this.toolbar=e.toolbar,this.component=e.component,this.inspector=e.inspector,this.insertion=e.insertion,this.selection=e.selection,this.block=e.block},ondropdown:{table:{observe:function(e){this._observeDropdown(e)}}},onbottomclick:function(){this.insertion.insertToEnd(this.editor.getLastNode(),"table")},start:function(){var n={observe:"table","insert-table":{title:this.lang.get("insert-table"),api:"plugin.table.insert"},"insert-row-above":{title:this.lang.get("insert-row-above"),classname:"redactor-table-item-observable",api:"plugin.table.addRowAbove"},"insert-row-below":{title:this.lang.get("insert-row-below"),classname:"redactor-table-item-observable",api:"plugin.table.addRowBelow"},"insert-column-left":{title:this.lang.get("insert-column-left"),classname:"redactor-table-item-observable",api:"plugin.table.addColumnLeft"},"insert-column-right":{title:this.lang.get("insert-column-right"),classname:"redactor-table-item-observable",api:"plugin.table.addColumnRight"},"add-head":{title:this.lang.get("add-head"),classname:"redactor-table-item-observable",api:"plugin.table.addHead"},"delete-head":{title:this.lang.get("delete-head"),classname:"redactor-table-item-observable",api:"plugin.table.deleteHead"},"delete-column":{title:this.lang.get("delete-column"),classname:"redactor-table-item-observable",api:"plugin.table.deleteColumn"},"delete-row":{title:this.lang.get("delete-row"),classname:"redactor-table-item-observable",api:"plugin.table.deleteRow"},"delete-table":{title:this.lang.get("delete-table"),classname:"redactor-table-item-observable",api:"plugin.table.deleteTable"}};void 0!==this.opts.tableClassNames&&(this.opts.tableClassNames.split(";").map(function(e){var t=e.split(",");if(t&&2===t.length){var a=t[1],i=t[0];n["set-table-style--"+i]={title:a,classname:"redactor-table-item-observable",api:"plugin.table.setTableStyle",args:i}}}),n["clear-table-style"]={title:this.lang.get("clear-table-style"),classname:"redactor-table-item-observable",api:"plugin.table.clearTableStyle"});var e={title:this.lang.get("table")},t=this.toolbar.addButtonBefore("link","table",e);t.setIcon('<i class="re-icon-table"></i>'),t.setDropdown(n)},insert:function(){var e=this.component.create("table");e.$element.addClass("table-asics-richeditor");for(var t=0;t<2;t++)e.addRow(3);e=this.insertion.insertHtml(e),this.caret.setStart(e)},addRowAbove:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent(),a=e.addRowTo(t,"before");this.caret.setStart(a)}},addRowBelow:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent(),a=e.addRowTo(t,"after");this.caret.setStart(a)}},addColumnLeft:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent();this.selection.save(),e.addColumnTo(t,"left"),this.selection.restore()}},addColumnRight:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent();this.selection.save(),e.addColumnTo(t,"right"),this.selection.restore()}},addHead:function(){var e=this._getComponent();e&&(this.selection.save(),e.addHead(),this.selection.restore())},deleteHead:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent();0!==l.dom(t).closest("thead").length?(e.removeHead(),this.caret.setStart(e)):(this.selection.save(),e.removeHead(),this.selection.restore())}},deleteColumn:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent(),a=l.dom(t).closest("td, th"),i=a.nextElement().get(),n=a.prevElement().get();e.removeColumn(t),i?this.caret.setStart(i):n?this.caret.setEnd(n):this.deleteTable()}},deleteRow:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent(),a=l.dom(t).closest("tr"),i=a.nextElement().get(),n=a.prevElement().get();e.removeRow(t),i?this.caret.setStart(i):n?this.caret.setEnd(n):this.deleteTable()}},deleteTable:function(){var e=this._getTable();e&&this.component.remove(e)},clearTableStyle:function(){var e=this._getTable();e&&l.dom(e).removeClass(this.opts.tableClassNames.toString().replace(/[,;]/g," "))},setTableStyle:function(e){var t=this._getTable();t&&(this.clearTableStyle(),l.dom(t).addClass(e))},_getTable:function(){var e=this.selection.getCurrent(),t=this.inspector.parse(e);if(t.isTable())return t.getTable()},_getComponent:function(){var e=this.selection.getCurrent(),t=this.inspector.parse(e);if(t.isTable()){var a=t.getTable();return this.component.create("table",a)}},_observeDropdown:function(e){var t=this._getTable(),a=e.getItemsByClass("redactor-table-item-observable"),i=e.getItem("insert-table");t?(this._observeItems(a,"enable"),i.disable()):(this._observeItems(a,"disable"),i.enable())},_observeItems:function(e,t){for(var a=0;a<e.length;a++)e[a][t]()}})}(Redactor),function(o){o.add("class","table.component",{mixins:["dom","component"],init:function(e,t){return this.app=e,t&&void 0!==t.cmnt?t:this._init(t)},addHead:function(){this.removeHead();var e=this.$element.find("tr").first().children("td, th").length,t=o.dom("<thead>"),a=this._buildRow(e,"<th>");t.append(a),this.$element.prepend(t)},addRow:function(e){var t=this._buildRow(e);return this.$element.append(t),t},addRowTo:function(e,t){return this._addRowTo(e,t)},addColumnTo:function(e,n){var t=o.dom(e),a=t.closest("tr"),i=t.closest("td, th"),l=0;a.find("td, th").each(function(e,t){e===i.get()&&(l=t)}),this.$element.find("tr").each(function(e){var t=o.dom(e).find("td, th").get(l),a=o.dom(t),i=a.clone();i.html(""),"right"===n?a.after(i):a.before(i)})},removeHead:function(){var e=this.$element.find("thead");0!==e.length&&e.remove()},removeRow:function(e){o.dom(e).closest("tr").remove()},removeColumn:function(e){var t=o.dom(e),a=t.closest("tr"),i=t.closest("td, th"),n=0;a.find("td, th").each(function(e,t){e===i.get()&&(n=t)}),this.$element.find("tr").each(function(e){var t=o.dom(e).find("td, th").get(n);o.dom(t).remove()})},_init:function(e){var t,a;if(void 0!==e){var i=o.dom(e),n=i.get(),l=i.closest("figure");0!==l.length?a=(t=l).find("table").get():"TABLE"===n.tagName&&(a=n)}this._buildWrapper(t),this._buildElement(a),this._initWrapper()},_addRowTo:function(e,t){var a=o.dom(e).closest("tr");if(0!==a.length){var i=a.children("td, th").length,n=this._buildRow(i);return a[t](n),n}},_buildRow:function(e,t){t=t||"<td>";for(var a=o.dom("<tr>"),i=0;i<e;i++){var n=o.dom(t);n.attr("contenteditable",!0),a.append(n)}return a},_buildElement:function(e){e?this.$element=o.dom(e):(this.$element=o.dom("<table>"),this.append(this.$element))},_buildWrapper:function(e){e=e||"<figure>",this.parse(e)},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"table",tabindex:"-1",contenteditable:!1})}})}(Redactor);