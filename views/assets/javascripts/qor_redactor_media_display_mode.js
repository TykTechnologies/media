"use strict";$R.add("plugin","mediadisplaymode",{langs:{en:{mediaDisplayMode:"Media Display Mode",mediaDisplayModeButton:"Display mode"}},getEditterButton:function(){return'<span id="redactor-image-displaymode" data-redactor="verified" contenteditable="false">'+this.lang.get("mediaDisplayModeButton")+"</span>"},getTemplate:function(){return String()+'<div class="redactor-modal-tab redactor-group">\n                <div id="redactor-image-preview" class="redactor-modal-tab-side"></div>\n                <div class="redactor-modal-tab-area" id="redactor-modal-displaymode">\n                    <section>\n                        <select id="modal-media-display-mode">\n                            <option value="0">Please select display mode</option>\n                        </select>\n                    </section>\n                    <section>\n                        <button id="redactor-modal-button-action">Save</button>\n                        <button id="redactor-modal-button-cancel">Cancel</button>\n                    </section>\n                </div></div>'},init:function(e){this.app=e,this.opts=e.opts,this.lang=e.lang,this.block=e.block,this.toolbar=e.toolbar,this.mediadisplaymode={}},start:function(){var e=$(this.app.editor.$editor.nodes[0]),t=this.opts.mediaDisplayModeOptions||"",a="",i=e.find("img");"pre"!==this.opts.type&&"inline"!==this.opts.type&&""!==t&&(t.split(/\||,/).forEach(function(e){var t=e.toLowerCase().replace(/\s/g,"");a=a+'<option value="'+t+'">'+e+"</option>"}),this.mediadisplaymode.$modes=a,e.on("click.redactor-mediadisplaymode touchstart.redactor-mediadisplaymode",i,this.setImageEditter.bind(this)))},insertButton:function(e){$(this.getEditterButton()).prependTo(e.closest("#redactor-image-box")).on("click.redactor-mediadisplaymode",this.show)},removeButton:function(e){$(e.target).closest("#redactor-image-box").length||($("#redactor-image-displaymode").remove(),$(document).off("click.redactor-mediadisplaymode"))},setImageEditter:function(e){var t=this,a=$(e.target),i=this.mediadisplaymode,d=a.closest(this.opts.imageTag);i.$imageTag=d,i.$image=a,i.currentDisplaymode=this.getDisplayMode(d.attr("class")),$(document).on("click.redactor-mediadisplaymode",this.removeButton),setTimeout(function(){t.insertButton(a)},10)},getDisplayMode:function(e){var t=e?e.match(/rd-display-\w+/):null;return t&&(t=t[0].replace("rd-display-","")),t},show:function(){var e=this.mediadisplaymode.currentDisplaymode;this.modal.addTemplate("mediadisplaymode",this.getTemplate()),this.modal.load("mediadisplaymode","Media Display Mode",600),this.modal.getActionButton().text(this.lang.get("save")).on("click",this.save),$("#modal-media-display-mode").append(this.mediadisplaymode.$modes),this.modal.show(),$("#modal-media-display-mode").val(e||0),$("#redactor-image-preview").html('<img src="'+this.mediadisplaymode.$image.prop("src")+'" style="max-width: 100%; opacity: 1">')},save:function(){var e=$("#modal-media-display-mode").val(),t=this.mediadisplaymode.$imageTag;t.removeClass(function(e,t){return(t.match(/rd-display-\w+/g)||[]).join(" ")}),0!=e&&t.addClass("rd-display-"+e),this.modal.close()}});