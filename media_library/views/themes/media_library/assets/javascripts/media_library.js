"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?e(require("jquery")):e(jQuery)}(function(f){var o="qor.medialibrary.action",e="enable."+o,t="keyup."+o,i="switched.qor.tabbar.radio",r='[data-toggle="qor.tab.radio"]',l='[data-tab-source="video_link"]',s=".qor-video__link",a=".qor-medialibrary__video-link",n=".qor-medialibrary__video",c=".qor-medialibrary__desc",m=".qor-file__options",d=".qor-bottomsheets__mediabox";function h(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);return!(!t||11!=t[7].length)&&t[7]}function u(e){var t=e.match(/(\/id_)(\w+)/);return!!(/http?:\/\/(www\.)|(v\.)youku.com/.test(e)&&t&&t[2])&&t[2]}function b(e,t){this.$element=f(e),this.options=f.extend({},b.DEFAULTS,f.isPlainObject(t)&&t),this.init()}return b.prototype={constructor:b,init:function(){this.bind(),this.initMedia()},bind:function(){f(document).on(i,r,this.resetMediaData.bind(this)).on(t,s,this.setVideo.bind(this)).on(t,c,this.setImageDesc.bind(this)).on("reload.qor.bottomsheets bottomsheetLoaded.qor.bottomsheets",d,this.initMedia.bind(this,"bottomsheet"))},unbind:function(){f(document).off(i,r,this.resetMediaData.bind(this)).off(t,s,this.setVideo.bind(this)).off(t,c,this.setImageDesc.bind(this))},setMediaData:function(e,t){var i=e.find(m),r=e.find('input[name="QorResource.MediaOption"]');i.val(JSON.stringify(t)),r.val(JSON.stringify(t))},setImageDesc:function(e){var t,i,r=f(e.target),o=r.closest("form");t=o.find(m),(i=JSON.parse(t.val())).Description=r.val(),this.setMediaData(o,i)},initMedia:function(e){var t=f(n),i=f(a);e&&(t=f(d).find(n),i=f(d).find(a)),f(d).find(".qor-table--medialibrary-file").each(function(){f(this).closest(".mdl-card__supporting-text").addClass("qor-table--files")}),(t.length||i.length)&&(t.each(function(){var e=f(this),t=e.data("videolink");t&&t.match(/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/)&&e.parent().addClass("qor-table--video qor-table--video-internal").html('<video width=100% height=100% controls><source src="'+t+'"></video>')}),i.each(function(){var e=f(this),t=e.data("videolink"),i=h(t),r=u(t);i?e.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width="100%" height="100%" src="//www.youtube.com/embed/'+i+'?rel=0" frameborder="0" allowfullscreen></iframe>'):r?e.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width=100% height=100% src="http://player.youku.com/embed/'+r+'" frameborder=0 "allowfullscreen"></iframe>'):e.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width=100% height=100% src="'+t+'" frameborder=0 "allowfullscreen"></iframe>')}))},setVideo:function(e){var t=f(e.target),i=t.closest("[data-tab-source]"),r=t.closest("form"),o=r.find(m),a=JSON.parse(o.val()),n=t.val(),d=i.find("iframe"),l=h(n),s=u(n);a.SelectedType="video_link",a.Video=n,a.Description=i.find(c).val(),this.setMediaData(r,a),i.find("iframe").remove(),l||s?(d.length&&d.remove(),l&&i.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+l+'?rel=0" frameborder="0" allowfullscreen></iframe>'),s&&i.append('<iframe width=100% height=400 src="http://player.youku.com/embed/'+s+'" frameborder=0 "allowfullscreen"></iframe>')):i.append('<iframe width=100% height=400 src="'+n+'" frameborder=0 "allowfullscreen"></iframe>')},resetMediaData:function(e,t,i){var r=f(t),o=r.closest("form"),a=r.find(m),n=r.find(l).find(".qor-fieldset__alert"),d=JSON.parse(a.val());"video_link"==(d.SelectedType=i)&&(d.Video=r.find(s).val(),n.length&&n.remove()),d.Description=f('[data-tab-source="'+i+'"]').find(c).val(),f('[name="QorResource.SelectedType"]').val(i),this.setMediaData(o,d)},destroy:function(){this.unbind()}},b.DEFAULTS={},f.fn.qorSliderAfterShow=f.fn.qorSliderAfterShow||{},f.fn.qorSliderAfterShow.renderMediaVideo=function(){var e=f(l),t=f(c),i=e.length&&e.data().videourl,r=i&&h(i),o=i&&u(i);t.length&&t.val(t.data().imageInfo.Description),e.length&&i&&(r?e.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+r+'?rel=0&fs=0&modestbranding=1&disablekb=1" frameborder="0" allowfullscreen></iframe>'):o?e.append('<iframe width=100% height=400 src="http://player.youku.com/embed/'+o+'" frameborder=0 "allowfullscreen"></iframe>'):e.append('<iframe width=100% height=400 src="'+i+'" frameborder=0 "allowfullscreen"></iframe>'))},b.plugin=function(r){return this.each(function(){var e,t=f(this),i=t.data(o);if(!i){if(/destroy/.test(r))return;t.data(o,i=new b(this,r))}"string"==typeof r&&f.isFunction(e=i[r])&&e.apply(i)})},f(function(){var t=".qor-table--medialibrary";f(document).on("disable.qor.medialibrary.action",function(e){b.plugin.call(f(t,e.target),"destroy")}).on(e,function(e){b.plugin.call(f(t,e.target))}).triggerHandler(e)}),b});